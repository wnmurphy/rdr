angular.module("booklist.services",[]).factory("Books",["$http","$rootScope",function(a,b){var c=function(){var c="/books";return b.signedIn&&(c="/books/signedin"),a({method:"GET",url:c}).then(function(a){return a.data},function(a){return console.log(a),a})},d=function(){return a({method:"GET",url:"/profile"}).then(function(a){return a.data})["catch"](function(a){return console.error(a),a})},e=function(b,c,d){return a({method:"POST",url:"/users/books",data:{book:b,author:{name:c},reaction:d}}).then(function(a){return a.data},function(a){return console.log(a),a})},f=function(b){var c="?";return b.title&&(c+="&title="+b.title),b.authorName&&(c+="&authorName="+b.authorName),a({method:"GET",url:"/amazon/"+c}).then(function(a){return a})["catch"](function(a){return a})},g=function(b){return a({method:"GET",url:"/user/"+b}).then(function(a){return a.data})["catch"](function(a){return console.error(a),a})},h=function(b,c){return a({method:"PUT",url:"/books",data:{reaction:b,bookId:c}}).then(function(a){return a.data})["catch"](function(a){return console.error(a),error})};return{updateReaction:h,getBooks:c,getProfile:d,getUserProfile:g,postBook:e,queryAmazon:f}}]).run(["$rootScope",function(a){a.reactions={1:"Hate it",2:"Dislike it",3:"Decent",4:"Like it",5:"Love it"},a.Math=window.Math,a.hash=function(a,b){var c=a.charCodeAt(Math.floor(a.length/2));return c-=10*Math.floor(c/10),c=c.toString(b),c=parseInt(c.charAt(c.length-1))},a.blankCovers=["/assets/img/black_cover_small.jpg","/assets/img/red_cover_small.jpg"]}]).directive("amazonThumbnail",function(){return{restrict:"A",link:function(a,b,c){var d;if(a.result.ImageSets&&(a.result.ImageSets[0].ImageSet.forEach(function(b,c){("primary"===b.$||!d&&c===a.result.ImageSets[0].ImageSet.length-1)&&(d=b)}),d)){var e;d.MediumImage&&(e=d.MediumImage[0].URL[0]),!e&&d.SmallImage&&(e=d.SmallImage[0].URL[0]),!e&&d.ThumbnailImage&&(e=d.ThumbnailImage[0].URL[0]),$(b).append('<img class="col s2 result-thumb" src="'+e+'"></img>')}}}}),angular.module("booklist",["booklist.services","booklist.feed","booklist.user","booklist.auth","booklist.search","auth0","angular-storage","angular-jwt","ngRoute","ngTouch"]).config(["$routeProvider","$httpProvider","authProvider","jwtInterceptorProvider",function(a,b,c,d){a.when("/",{templateUrl:"/app/shared/book.feed.html",controller:"FeedController"}).when("/profile",{templateUrl:"/app/shared/user.page.html",controller:"UserController",requiresLogin:!0}).when("/about",{templateUrl:"/app/components/about.html"}).when("/privacy",{templateUrl:"/app/components/privacy.html"}).when("/searchuser",{templateUrl:"/app/shared/user.feed.html",controller:"UserFeedController",requiresLogin:!0}).otherwise({templateUrl:"/app/shared/book.feed.html",controller:"FeedController"})}]).config(["authProvider","jwtInterceptorProvider","$httpProvider",function(a,b,c){a.init({domain:"rdr2.auth0.com",clientID:"x3GFCfuxeqpWqPRt9HZHXjjg0MCne8VI",callbackURL:"#/profile",loginUrl:"/"}),b.tokenGetter=["store",function(a){return a.get("token")}],c.interceptors.push("jwtInterceptor")}]).run(["$rootScope","auth","store","$location","jwtHelper",function(a,b,c,d,e){b.hookEvents(),a.$on("$locationChangeStart",function(d,f,g){var h=c.get("token");h&&(e.isTokenExpired(h)?a.signedIn=!1:b.isAuthenticated||(b.authenticate(c.get("profile"),h),a.signedIn=!0))})}]),angular.module("booklist.auth",[]).controller("AuthController",["$rootScope","$scope","$http","auth","store","$location","$timeout",function(a,b,c,d,e,f,g){b.login=function(){d.signin({},function(b,d){e.set("profile",b),e.set("token",d),c({method:"post",url:"/signin"}).then(function(b){a.signedIn=!0,f.path("/")})["catch"](function(a){console.error(a)})},function(a){console.log(a)})},b.logout=function(){a.signedIn=!1,d.signout(),e.remove("profile"),e.remove("token"),g(function(){f.path("/")},1)}}]),angular.module("booklist.feed",[]).controller("FeedController",["$scope","Books",function(a,b){a.data={},a.bookTemplate="app/shared/book.entry.html",a.getBooks=function(){b.getBooks().then(function(b){a.data.books=b,a.data.books.forEach(function(a){a.reaction&&(a.reactionSlider=25*(a.reaction-1))})})["catch"](function(a){console.log(a)})},a.addToReadList=function(a,c,d,e,f,g,h,i,j,k,l){b.postBook({title:a,ISBN:c,publisher:d,high_res_image:e,large_image:f,medium_image:g,small_image:h,thumbnail_image:i,amz_url:j},k,0),l.reaction=0,Materialize.toast("Added to your reading list!",1750)},a.getBooks()}]),angular.module("booklist.search",[]).controller("UserFeedController",["$scope","Books","$rootScope","$timeout","$location","auth",function(a,b,c,d,e,f){a.user={},a.books=[],a.search={field:null},a.auth=f,a.firstName=a.auth.profile.nickname,a.submitting=!1,a.bookTemplate="app/shared/book.entry.html",a.scrollToTop=function(a){$target=$(a.target),$target.hasClass("active")&&$('.book-collection:not([display="none"])').animate({scrollTop:0},"500","swing")},a.userQuery=function(c){var d=a.search.field;a.search.field=null,b.getUserProfile(d).then(function(b){b.books.forEach(function(a){b.authors.forEach(function(b){b.id===a.author_id&&(a.author.name=b.name)})}),a.books=b.books,a.books.forEach(function(a){a.reactionSlider=25*(a.reaction-1)})})["catch"](function(a){console.error("Error getting user profile:",a)})},a.filterReactions=function(a){return a.reaction>0}}]),angular.module("booklist.user",[]).controller("UserController",["$scope","Books","$rootScope","$timeout","$location","$http","$route","auth",function(a,b,c,d,e,f,g,h){a.user={},a.books=[],a.path=e.path(),a.readit=!0,a.auth=h,a.firstName=a.auth.profile.nickname,a.submitting=!1,a.bookTemplate="app/shared/book.entry.html",a.bookTitle="",a.authorName="",a.publicationYear="",a.amz_url="",a.publisher="",a.ISBN="",a.reaction=void 0,a.high_res_image="",a.medium_image="",a.small_image="",a.thumbnail_image="",a.amazonResults=[],a.addReaction=function(a,c){a=Number(a)+1,b.updateReaction(a,c.id).then(function(b){console.log("Successful reaction PUT:",b),a>0?c.reactionSlider=JSON.stringify(25*(a-1)):c.reactionSlider="0",c.reaction=a})["catch"](function(a){console.error(a)})},a.addToReadingList=function(){a.reaction=0},a.deleteBookFromList=function(b){var c=confirm("Remove this book from list?");return c?f({method:"post",url:"/users/books/deleteBook",data:{title:b}}).then(function(b){return a.resetProfile(),b.data},function(a){return console.log(a),a}):void 0},a.emptyBookLists=function(b){var c=confirm("Remove all books from this list?");return c?f({method:"post",url:"/users/books/emptyBookLists",data:{list:b}}).then(function(b){a.resetProfile()},function(a){return console.log(a),a}):void 0},a.setReaction=function(b,c){var d=$(b.currentTarget);$(".reaction-buttons").find(".selected").removeClass("selected"),a.reaction===c?a.reaction=void 0:(d.addClass("selected"),a.reaction=c)},a.scrollToTop=function(a){$target=$(a.target),$target.hasClass("active")&&$('.book-collection:not([display="none"])').animate({scrollTop:0},"500","swing")},a.updateReaction=function(a){a.reaction=a.reactionSlider/25+1,b.postBook({title:a.title,ISBN:a.ISBN,publisher:a.publisher,high_res_image:a.high_res_image,large_image:a.large_image,medium_image:a.medium_image,small_image:a.small_image,thumbnail_image:a.thumbnail_image},a.author.name,a.reaction)},a.initialize=function(){a.resetProfile(),$(".add-book").on("click",function(a){var b=$(a.target);b.hasClass("active")||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||setTimeout(function(){$("#title").focus()},250)}),f({method:"PUT",url:"/profile",data:{user:a.auth.profile.user_id,email:a.auth.profile.email}}).then(function(a){isNaN(a.data)?console.log(a.data):console.log("Successful email PUT:",a)})["catch"](function(a){console.error(a)})},a.resetProfile=function(){b.getProfile().then(function(b){b.books&&(a.books=b.books,a.books.forEach(function(a){a.reactionSlider=25*(a.reaction-1)}))})["catch"](function(a){console.error(a)})},a.checkAmazon=function(){a.bookTitle=a.bookTitle||"",a.authorName=a.authorName||"";var c=a.bookTitle.trim(),d=a.authorName.trim();c.length||d.length?(a.submitting=!0,b.queryAmazon({title:c,authorName:d}).then(function(b){console.log(b),b.data[0]&&!b.data[0].Error?a.amazonResults=b.data:a.amazonResults=[],$(".amazon-results").scrollTop(0),a.submitting=!1})["catch"](function(b){a.submitting=!1})):a.amazonResults=[]};var i;a.searchTimer=function(){d.cancel(i),i=d(a.checkAmazon,400)},a.selectAmazonResult=function(b){b.ItemAttributes[0].Title&&(a.bookTitle=b.ItemAttributes[0].Title[0]),b.ItemAttributes[0].Author&&(a.authorName=b.ItemAttributes[0].Author[0]),b.ItemAttributes[0].PublicationDate&&(a.publicationYear=b.ItemAttributes[0].PublicationDate[0].split("-")[0]),b.ItemAttributes[0].Publisher&&(a.publisher=b.ItemAttributes[0].Publisher[0]),b.DetailPageURL&&(a.amz_url=b.DetailPageURL[0].split("%")[0]+"?camp=1789&creative=9325&linkCode=ur2&tag=rdr0a-20"),b.ItemAttributes[0].ISBN&&(a.ISBN=b.ItemAttributes[0].ISBN[0]);for(var c=b.ImageSets[0].ImageSet[0],d=1;d<b.ImageSets[0].ImageSet.length;d++){var e=b.ImageSets[0].ImageSet[d];if("primary"===e.$.Category){c=e;break}}c&&(c.HiResImage&&(a.high_res_image=c.HiResImage[0].URL[0]),c.LargeImage&&(a.large_image=c.LargeImage[0].URL[0]),c.MediumImage&&(a.medium_image=c.MediumImage[0].URL[0]),c.SmallImage&&(a.small_image=c.SmallImage[0].URL[0]),c.ThumbnailImage&&(a.thumbnail_image=c.ThumbnailImage[0].URL[0])),a.amazonResults=[],$('label[for="author"]').addClass("active"),$('label[for="title"]').addClass("active"),$("body").animate({scrollTop:$(".greet").offset().top,duration:1750})},a.addBook=function(){b.postBook({title:a.bookTitle,ISBN:a.ISBN,publisher:a.publisher,high_res_image:a.high_res_image,large_image:a.large_image,medium_image:a.medium_image,small_image:a.small_image,thumbnail_image:a.thumbnail_image,amz_url:a.amz_url},a.authorName,a.reaction).then(function(b){if(b.book&&b.author){var c=b.book;c.author={},c.ISBN=a.ISBN,c.author.name=b.author.name,c.reaction=a.reaction,c.reactionSlider=25*(c.reaction-1),c.high_res_image=a.high_res_image,c.large_image=a.large_image,c.medium_image=a.medium_image,c.small_image=a.small_image,c.thumbnail_image=a.thumbnail_image,c.amz_rul=a.amz_url,a.clearBookInfo(),a.resetProfile(),Materialize.toast("Book added!",1750)}})["catch"](function(a){console.error(a)})},a.clearBookInfo=function(){a.bookTitle="",a.authorName="",a.reaction=void 0,a.clearAmazonInfo(),$(".reactions").find(".selected").removeClass("selected")},a.clearAmazonInfo=function(){a.publicationYear="",a.amz_url="",a.publisher="",a.high_res_image="",a.ISBN="",a.large_image="",a.medium_image="",a.small_image="",a.thumbnail_image=""},a.filterReactions=function(a){return a.reaction>0},a.initialize()}]);
//# sourceMappingURL=app.min.js.map